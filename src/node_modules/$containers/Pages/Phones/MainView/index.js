import React, { Component } from 'react';

import FilterModal from '$components/Modal/FilterModal'
import Table from '$components/Table';
import PhoneCard from '../PhoneCard';
import Loading from '$components/Loading';

import style from '../Phones.module.css';

class MainView extends Component {

  componentWillUnmount () {
    this.props.saveScrollPos(window.pageYOffset);
  }

  componentDidMount = () => {

    window.scrollTo(0, this.props.scrollPos);

    if (!this.props.items.length) this.props.fetchPhones();
    
    let navPanelItems = [
      { type: 'cart' },
      { 
        type: 'filter',
        onClick: () => {
          this.props.openModal(
            <FilterModal
              query={this.props.query}
              onSubmit={(query) => this.props.filter(query)}
            />
          );
        }
      }
    ];

    this.props.setNavPanelItemsState(navPanelItems);
    
  }

  renderLoadMoreBtn = () => {
    if (this.props.fetching) return <div style={{textAlign: 'center', padding: '25px'}}><Loading/></div>
    return this.props.hasMore && (
      <div 
        onClick={this.props.fetchPhones}
        className={style.loadMore}
      >Load more</div>
    );
  }



  render() {

    let items = this.props.items.map((item, i) => (
      <PhoneCard 
        key={i} 
        onImageLoaded={this.props.onImageLoaded} 
        data={item}
        toCart={(item) => {
          this.props.addProductToBasket(item);
          this.props.pushMessage(`${item.name} added to cart`);
        }}
      />
    ))
    return (
      <div>
        <Table items={items}/>
        {this.renderLoadMoreBtn()}
      </div>
    );
  }

}

export default MainView;