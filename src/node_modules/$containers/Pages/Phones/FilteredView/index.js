import React, { Component } from 'react';

import FilterModal from '$components/Modal/FilterModal'
import ConfirmModal from '$components/Modal/ConfirmModal'
import Table from '$components/Table';
import PhoneCard from '../PhoneCard';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';

import style from '../Phones.module.css';

class FilteredView extends Component {

  componentDidMount = () => {

    window.scrollTo(0, 0);
    
    let navPanelItems = [
      { type: 'cart' },
      { 
        type: 'filter',
        onClick: () => {
          this.props.openModal(
            <FilterModal
              query={this.props.query}
              onSubmit={(query) => this.props.filter(query)}
            />
          );
        }
      }
    ];

    this.props.setNavPanelItemsState(navPanelItems);
    
  }

  renderSearchInfo = () => {
    return (
      <div className={style.searchInfoWrapper}>
        <h4>Total results: {this.props.items.length}</h4>
        <div 
          onClick={() => {
            this.props.openModal(
              <ConfirmModal
                text="Do you want to clear filter?"
                onConfirm={() => {
                  this.props.filter('');
                }}
              />
            );
          }}
          style={{cursor: 'pointer'}}
        >
          <span>Clear filter</span>
          <FontAwesomeIcon icon="times"/>
        </div>
      </div>
    );
  }

  render() {

    let items = this.props.items.map((item, i) => (
      <PhoneCard 
        key={i} 
        onImageLoaded={this.props.onImageLoaded} 
        data={item}
        toCart={(item) => {
          this.props.addProductToBasket(item);
          this.props.pushMessage(`${item.name} added to cart`);
        }}
      />
    ))
    return (
      <div>
        {this.renderSearchInfo()}
        <Table items={items}/>
      </div>
    );
  }

}


export default FilteredView;