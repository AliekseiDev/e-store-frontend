import React, { Component } from 'react';
import { connect } from 'react-redux';

import MainView from './MainView';
import FilteredView from './FilteredView';

import { fetchPhones, onImageLoaded, cleanProducts, saveScrollPos, filter } from '$actions/phonesPageActions';
import { addProductToBasket } from '$actions/basketActions';
import { setNavPanelItemsState, openModal, pushNavPanelItemsState, popNavPanelItemsState, pushMessage } from '$actions/layoutActions';
import { getPhonesByIds, withBasket, withFilter } from '$selectors';

class Phones extends Component {

  render() {

    return (
      this.props.filterMode ?
        <FilteredView {...this.props}/>
      :
        <MainView {...this.props}/>
    );
  }

}

const mapStateToProps = state => {
  let { ids, products, query } = state.phonesPage;

  
  let filterMode = query.length ? true : false;
  let items = filterMode ? 
    withBasket(
      withFilter(
        getPhonesByIds(products, ids),
        query
      ),
      state
    )
      :
    withBasket(getPhonesByIds(products, ids), state);


  return {
    items,
    filterMode,
    ...state.phonesPage
  }
}

const mapDispatchToProps = {
  addProductToBasket,
  fetchPhones, cleanProducts, saveScrollPos, filter,
  onImageLoaded,
  setNavPanelItemsState, pushNavPanelItemsState, popNavPanelItemsState,
  openModal,
  pushMessage
};

export default connect(mapStateToProps, mapDispatchToProps)(Phones);